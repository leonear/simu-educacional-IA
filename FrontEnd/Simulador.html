<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador de Investimento</title>
    <link rel="stylesheet" href="simulador.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="dashboard-container">
        <aside class="sidebar">
            <div class="sidebar-header">EducaFinan√ßas</div>
            <nav class="sidebar-menu">
                <ul>
                    <li><button class="menu-btn" onclick="window.location.href='TelaInicio.html'"><span class="icon">üè†</span> In√≠cio</button></li>
                    <li><button class="menu-btn" onclick="window.location.href='Minicurso.html'"><span class="icon">üìö</span> Cursos</button></li>
                    <li><button class="menu-btn active"><span class="icon">üßÆ</span> Simulador</button></li>
                    <li><button class="menu-btn" onclick="window.location.href='CarteiraVirtual.html'"><span class="icon">üí∞</span> Meus Investimentos</button></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <header class="main-header">
                <h2>Simulador de Invetimento</h2>
                <div class="simulador-tabs">
                    <button class="tab-btn active">A√ß√µes</button>
                    <button class="tab-btn" onclick="window.location.href='RendaFixa.html'">Renda fixa</button>
                </div>
            </header>
            <div class="simulador-busca">
                <input type="text" id="input-simbolo" placeholder="Buscar a√ß√£o...">
                <button class="buscar-btn" onclick="buscarAcao()">Buscar</button>
            </div>
            <div id="info-acao-dinamica"></div>
            <div class="simulador-grid" id="simulador-grid" style="display:none">
                <div class="simulador-info">
                    <div class="info-title"><span id="nome-empresa"></span> <span class="dot"></span></div>
                    <div class="info-content info-grid" id="info-content">
                        <!-- Conte√∫do din√¢mico -->
                    </div>
                </div>
                <div class="simulador-grafico">
                    <div class="grafico-title">Gr√°fico - Varia√ß√£o Anual <span class="dot"></span></div>
                    <div class="grafico-img">
                        <canvas id="grafico-acao" width="800" height="260"></canvas>
                    </div>
                </div>
                <div class="simulador-analise">
                    <div class="analise-title">An√°lise e Recomenda√ß√£o</div>
                    <div class="analise-content" id="analise-content">
                        <!-- Conte√∫do din√¢mico -->
                    </div>
                </div>
            </div>
            <div class="simulador-btn-final">
                <button class="comprar-btn">COMPRAR</button>
            </div>
        </main>
    </div>
    <script>
    let grafico = null;
    function buscarAcao() {
        let simbolo = document.getElementById('input-simbolo').value.trim().toUpperCase();
        // Se n√£o tiver ponto, assume a√ß√£o brasileira e adiciona .SA
        if (simbolo && !simbolo.includes('.')) {
            simbolo += '.SA';
        }
        if (!simbolo) return;
        fetch(`http://localhost:5000/acao?simbolo=${simbolo}`)
            .then(response => response.json())
            .then(data => {
                if (data.erro) {
                    document.getElementById('info-acao-dinamica').innerHTML = `<div style='color:red'>${data.erro}</div>`;
                    document.getElementById('simulador-grid').style.display = 'none';
                    return;
                }
                document.getElementById('simulador-grid').style.display = '';
                document.getElementById('info-acao-dinamica').innerHTML = '';
                document.getElementById('nome-empresa').innerHTML = `<span style='color:#2e8b57;font-weight:bold;'>${data.nome_empresa}</span> <span style='color:#1a355e;font-weight:normal;'>(${data.sigla})</span> - Informa√ß√µes`;
                document.getElementById('info-content').innerHTML = `
                    <div class="info-col">
                        <div>Pre√ßo Atual: <b>R$ ${data.preco_atual.toFixed(2)}</b></div>
                        <div>M√°ximo (12m): <b>R$ ${data.max_12m.toFixed(2)}</b></div>
                        <div>Varia√ß√£o: <b>${data.variacao.toFixed(2)}</b></div>
                    </div>
                    <div class="info-col">
                        <div>Volume: <b>${data.volume.toLocaleString('pt-BR')}</b></div>
                        <div>M√©dia (12m): <b>R$ ${data.media_12m.toFixed(2)}</b></div>
                        <div>M√≠nimo (12m): <b>R$ ${data.min_12m.toFixed(2)}</b></div>
                    </div>
                `;
                document.getElementById('analise-content').innerHTML = `
                    Margem de Seguran√ßa: R$ ${data.margem_seguranca.toFixed(2)}<br>
                    Risco: ${data.risco}<br>
                    Recomenda√ß√£o: ${data.recomendacao}
                `;
                // Montar o gr√°fico
                if (grafico) grafico.destroy();
                const ctx = document.getElementById('grafico-acao').getContext('2d');
                grafico = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.datas_grafico.map(dt => dt.split('-').reverse().join('/')),
                        datasets: [{
                            label: 'Pre√ßo de Fechamento',
                            data: data.precos_grafico,
                            borderColor: 'green',
                            backgroundColor: 'rgba(0, 128, 0, 0.1)',
                            fill: true,
                            tension: 0.2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            x: { display: true, title: { display: false } },
                            y: { display: true, title: { display: false } }
                        }
                    }
                });
            })
            .catch(() => {
                document.getElementById('info-acao-dinamica').innerHTML = `<div style='color:red'>Erro ao buscar a√ß√£o.</div>`;
                document.getElementById('simulador-grid').style.display = 'none';
            });
    }
    </script>
</body>
</html>
